---
- name: ensure all servers are commonly configured (without sudo)
  hosts: localhost
  remote_user: travis
  sudo: false

  tasks:
    - name: ensure IP address of the ansible controller is set
      set_fact:
        ansible_controller: '{{ ansible_env.SSH_CLIENT.split(" ") | first }}/32'
      when: ansible_controller is undefined and ansible_connection != "local"
      tags: ferm

- name: ensure all servers are commonly configured (with sudo)
  hosts: localhost
  remote_user: travis
  sudo: true

  roles:
    - role: ansible-ferm
      tags: [app, ferm]
      ferm_input_list:
        - type: "dport_accept"
          dport: ["http"]
          filename: "nginx_accept"